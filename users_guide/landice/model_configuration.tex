\chapter{Model Configuration}

This chapter describes the configuration of the Land Ice core.  
The chapter covers the dimensions used in the model, the Namelist options which 
are used to provide run-time configurability of model options, the variables
used in the model, and the usage of run-time I/O streams.

\label{chap:ModelConfiguration}

% Note: the autogenerated sections are generated by MPAS-Tools/python_scripts/namelist_generation/parse_ocean_xml_registry.py
% and then copied into MPAS-Documents/users_guide/landice/autogenerated_docs_from_registry.
% Doug has created an overly complicated version (it handles forward and analysis modes, which we don't have) of this autogen script for the ocean core.
% I have created a branch of it that hacks it for use with the land ice core.  It is in my fork as landice_userguide_autogen_mods.
% Invoke with something like: python parse_ocean_xml_registry.py -f ~/documents/mpas-git/MPAS/src/core_landice/Registry_processed.xml -a ~/documents/mpas-git/MPAS/src/core_landice/Registry_processed.xml -d /Users/mhoffman/documents/mpas-git/MPAS-Documents/users_guide/landice/section_descriptions -p landice/section_descriptions
% Note that it will use the pre-processed version of Registry, not the raw version, so you have to have compiled the code itself.
% Then copy the result to the users guide source directory:
% cp define_version.tex namelist_sections.tex variable_sections.tex ~/documents/mpas-git/MPAS-Documents/users_guide/landice/autogenerated_docs_from_registry/
% and rename the mode_forward version:
% cp mode_forward_sections.tex ~/documents/mpas-git/MPAS-Documents/users_guide/landice/autogenerated_docs_from_registry/registry_sections.tex

\input{landice/autogenerated_docs_from_registry/registry_sections.tex}



% =================================
% Run time streams summary

\section{Run-time input/output streams}

Chapter \ref{chap:mpas_io} provides a detailed overview of the implementation of
run-time input/output streams in MPAS.  Within the Land Ice core, the following 
streams are defined at build time:

\subsection{input}
This is an immutable stream defining the fields required for input.  It is only read at the initial time.  Input files may have other fields in them, but only the fields specified in this stream definition are actually read.
Default name is \texttt{landice\_grid.nc}.

The input stream consists of the following members:
\begin{itemize}
  \item stream name="basicmesh"
  \item var\_array name="tracers"
  \item var name="thickness"
  \item var name="normalVelocity"
  \item var name="bedTopography"
  \item var name="sfcMassBal"
\end{itemize}


\subsection{output}
This is a mutable stream defining the fields that will be output.  
Because it is mutable, the list of fields for output may be modified at run time by editing the streams.landice file.
Default name is \texttt{output.nc}.  Default clobber mode is \texttt{replace\_files}, \textbf{which will overwrite existing output}.


The output stream consists of the following members by default:
\begin{itemize}
  \item 			stream name="basicmesh"
  \item			var\_array name="tracers"
  \item			var name="xtime"
  \item			var name="thickness"
  \item			var name="layerThickness"
  \item			var name="lowerSurface"
  \item			var name="upperSurface"
  \item			var name="cellMask"
  \item			var name="edgeMask"
  \item			var name="vertexMask"
  \item			var name="normalVelocity"
  \item			var name="uReconstructX"
  \item			var name="uReconstructY"
  \item			var name="uReconstructZ"
  \item			var name="uReconstructZonal"
  \item			var name="uReconstructMeridional"
\end{itemize}


\subsection{restart}
This is an immutable stream defining the fields required for restart.  
It is both an input and output stream. The model writes restart files with 
a single time level in them periodically.  If a restart from one of these checkpoints 
is desired, set \texttt{config\_do\_restart} to \texttt{.true.} and set 
\texttt{config\_start\_time} to \texttt{file} in \texttt{namelist.landice}.  
The model will take the start time from the value in the text file specified by 
\texttt{config\_restart\_timestamp\_name} (default name is ``restart\_timestamp''), 
and use the associated .nc file to restart the model from that checkpoint.

Default name is \texttt{restart.\$Y-\$M-\$D\_\$h.\$m.\$s.nc} with a new file for each checkpoint. Default clobber mode is \texttt{replace\_files}, \textbf{which will overwrite existing output}.

The user does not need to keep track of what fields are required for restart, 
but for reference they are:
\begin{itemize}
  \item			stream name="basicmesh"
  \item			var\_array name="tracers"
  \item			var name="xtime"
  \item			var name="thickness"
  \item			var name="cellMask"
  \item			var name="normalVelocity"
  \item			var name="bedTopography"
  \item			var name="sfcMassBal"
\end{itemize}


\subsection{basicmesh}
This is an immutable stream that specifies the list of fields that make up the 
MPAS mesh specification.  It is provided as a convenience for including mesh fields
in other streams without having to list them all explicitly.


\subsection{Other streams}

As described in Chapter \ref{chap:mpas_io}, additional streams may be added by 
the user at run-time.  One common example would be a ``forcing'' stream that gets
read at each time level while the model runs.  This can be accomplished by 
creating an input stream with \texttt{input\_interval} set to a time interval.
If the model does not find the current time in the forcing file, it will read the 
latest value before the current time instead (piecewise constant forcing).




